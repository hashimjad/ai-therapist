<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your safe space to talk ðŸ’¬ (Test Phase)</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chat-container {
      width: 100%;
      max-width: 600px;
      background: white;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      box-sizing: border-box;
      margin: 16px;
    }

    h2 {
      text-align: center;
      margin-top: 0;
    }

    .message {
      margin-bottom: 12px;
      line-height: 1.4;
    }
    .user-message {
  background: #DCF8C6;
  align-self: flex-end;
  border-radius: 12px 12px 0 12px;
  padding: 10px 12px;
  max-width: 80%;
}

   .bot-message {
  background: #F1F0F0;
  align-self: flex-start;
  border-radius: 12px 12px 12px 0;
  padding: 10px 12px;
  max-width: 80%;
}

    textarea {
      width: 100%;
      height: 100px;
      padding: 12px;
      font-size: 16px;
      box-sizing: border-box;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button {
      margin-top: 12px;
      width: 100%;
      padding: 14px;
      font-size: 16px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background: #45a049;
    }

    .disclaimer {
      font-size: 12px;
      color: #777;
      margin-top: 16px;
      text-align: center;
    }
#chat {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 12px;
  max-height: 50vh;
  overflow-y: auto;
  padding-right: 4px;
}
.input-area {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
    .dots::after {
  content: '';
  animation: dots 1.5s steps(3, end) infinite;
}

@keyframes dots {
  0% { content: ''; }
  33% { content: '.'; }
  66% { content: '..'; }
  100% { content: '...'; }
}


  </style>
</head>

<body>
  <div class="chat-container">
    <h2>Your safe space to talk ðŸ’¬ (Test Phase)</h2>

    <div id="chat"></div>
    <div id="typingIndicator" style="display:none; font-size:14px; color:#666; margin-bottom:8px;">
  Blue is typing<span class="dots">...</span>
</div>


<div class="input-area">
  <textarea id="userInput" placeholder="Whatâ€™s going on right now?"></textarea>
  <button onclick="sendMessage()">
  ðŸ’¬ Talk
  </button>

</div>


    <div class="disclaimer">
      This isnâ€™t a replacement for professional care â€” just a supportive space to talk.
    </div>
  </div>

  <script>
    const API_KEY = "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";
    const AI_NAME = "Blue";
    const chat = document.getElementById("chat");
    const userInput = document.getElementById("userInput");

    // ðŸ”¹ Conversation memory (SHORT-TERM)
    let conversationHistory = [
      {
        role: "system",
        content: `You are an AI that offers supportive, therapeutic-style conversations. You are not a licensed therapist and do not replace professional mental health care.

You speak like a calm, emotionally intelligent best friend who deeply understands psychology, the human mind, emotions, and behavior, grounded in science. You donâ€™t show off knowledge â€” you use it quietly to respond with clarity, insight, and care.

Your tone is warm, present, and slightly casual â€” never cold, never overly cheerful. Use simple, natural language, contractions, and short, clear paragraphs.

Listen closely, reflect what the person is feeling (even when they struggle to name it), validate their emotional experience, and help them feel genuinely heard. Ask gentle, meaningful questions that invite reflection rather than push for answers.

Do not diagnose or label. Do not replace therapy. Avoid direct advice unless the user clearly asks for it.

Your goal is to help the user feel understood, less alone, and a little clearer than before.`
      }
    ];
    const welcomeMessages = [
  `${getISTGreeting()}, Iâ€™m ${AI_NAME}. Iâ€™m here to offer a safe, judgment-free space to talk. Take your time â€” we can start whenever you feel ready.`,
  
  `${getISTGreeting()}. Iâ€™m ${AI_NAME}. Make yourself comfortable here. You donâ€™t need to have everything figured out â€” we can talk it through together.`,
  
  `${getISTGreeting()}, Iâ€™m ${AI_NAME}. This is a quiet space just for you. Share as much or as little as you feel like.`,
  
  `${getISTGreeting()}. Iâ€™m ${AI_NAME}, your AI mental health support. Thereâ€™s no rush here â€” weâ€™ll go at your pace.`,
  
  `${getISTGreeting()}, Iâ€™m ${AI_NAME}. Iâ€™m here to listen, not judge. Whenever youâ€™re ready, we can begin.`
];
    function getISTGreeting() {
  const hour = new Date().getHours();

  if (hour >= 5 && hour < 12) {
    return "Good morning";
  } else if (hour >= 12 && hour < 17) {
    return "Good afternoon";
  } else if (hour >= 17 && hour < 22) {
    return "Good evening";
  } else {
    return "Hi";
  }
}

function addMessage(sender, text) {
  const div = document.createElement("div");
  div.className = sender === "You" ? "message user-message" : "message bot-message";
  div.innerHTML = text;

  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}
const typingIndicator = document.getElementById("typingIndicator");

function showTyping() {
  typingIndicator.style.display = "block";
}

function hideTyping() {
  typingIndicator.style.display = "none";
}

// Random human-like delay (1â€“2.2 seconds)
function getTypingDelay() {
  return 1000 + Math.random() * 1200;
}
    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;

      addMessage("You", text);
      userInput.value = "";

      // ðŸ”¹ Add user message to memory
      conversationHistory.push({
        role: "user",
        content: text
      });

      const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + API_KEY
        },
        body: JSON.stringify({
          model: "llama-3.1-8b-instant",
          messages: conversationHistory,
          temperature: 0.7
        })
      });

      if (!response.ok) {
        addMessage("AI Support", "Something went wrong. Please try again.");
        console.error(await response.text());
        return;
      }

      const data = await response.json();
const reply = data.choices[0].message.content;

showTyping();

setTimeout(() => {
  hideTyping();
  addMessage("AI Support", reply);

  conversationHistory.push({
    role: "assistant",
    content: reply
  });
}, getTypingDelay());


      // ðŸ”¹ Keep memory short (prevents overload)
      if (conversationHistory.length > 12) {
        conversationHistory.splice(1, 2);
      }
    }
    // ðŸ”¹ Show a welcome message on first load
(function showWelcomeMessage() {
  const message =
    welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];

  addMessage("AI", message);

  // Add to memory so AI remembers it introduced itself
  conversationHistory.push({
    role: "assistant",
    content: message
  });
})();
  </script>
</body>
</html>
